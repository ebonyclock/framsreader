[
  {
    "name": "Creature",
    "_classname": "show",
    "expdef": "standard",
    "code": "@include \"AL-shared.inc\"\n@include \"AL-sending.inc\"\n@include \"AL-objects.inc\"\n\nglobal g_floating;\nglobal g_floating_orient;\nglobal g_restore_anim;\n\nfunction printobj3d(o,indent)\n{\nvar t=\"\";\nfor(var i=0;i<indent;i++) t+=\"   \";\nt+=o;\nt+=\" \\\"\"+o.name+\"\\\" \"+o.material+\" (\"+o.children+\" children) size:\"+o.size;\nSimulator.print(t);\nfor(var i=0;i<o.children;i++)\n   printobj3d(o[i],indent+1);\n}\n\nfunction genotypeByID(id)\n{\n\tfor(var g in GenePools[0])\n\t\tif (g.num==id) return g;\n\treturn null;\n}\n\nfunction addDemoCreatures()\n{\n\t//prepare world\n\tWorld.wrldsiz=20;\n\tWorld.wrldtyp=1;\n\tWorld.wrldmap=\"m 3 3 555595555\";\n\tWorld.wrldwat=-10;\n\tWorld.wrldbnd=2;//teleport\n\tExpProperties.MaxCreated=0;\n\n\t//load and add to population\n\tvar selected_IDs=[56,58,59,60,61,62,63,64,65,73,77,79,86,87,89,91,287];\n\tSimulator.import(\"walking.gen\");\n\tPopulations[0].energy=0;\n\tfor(var count=3;count>0;count--)\n\t{\n\t\tvar cr = Populations[0].add(genotypeByID(selected_IDs[Math.random(selected_IDs.size)]));\n\t\tcr.nnenabled = 1;\n\t\tvar a=Math.rnd01*Math.pi*2;\n\t\tcr.locationSetBboxLow(10.0+8.0*Math.cos(a)-cr.bboxSize.x/2,10.0+8.0*Math.sin(a)-cr.bboxSize.y/2, 0);\n\t\tcr.rotate(0,0,Math.rnd01*Math.twopi);\n\t}\n}\n\nfunction beforeLoad()\n{\nGLDisplay.back_action=\"\";\n}\n\nfunction addText3D(txt,align,size,rotation)\n{\nvar ret=null,newline,moretxt=\"\",t=null,shift=0.0;\nwhile(txt!=\"\")\n  {\n  newline=String.indexOf(txt,\"\\n\");\n  if (newline>=0) {moretxt=String.substr(txt,newline+1); txt=String.substr(txt,0,newline);} else moretxt=\"\";\n  if (t!=null) { if (ret==null) ret=GLDisplay.world3d.add(Obj3D.newEmpty()); ret.add(t); shift+=size*1.1; }\n  t=GLDisplay.world3d.add(Obj3D.newText(txt,align,-1,Matrix.newScale(size).rotate((1,0,0),1.57).rotate((0,1,0),rotation)));\n  if (shift>0) t.transform=t.transform.translate((0,0,-shift));\n  txt=moretxt;\n  }\nif (ret) {ret.add(t); return ret;} else return t;\n}\n\nfunction onLoad()\n{\nGLDisplay.user_interaction=2;\nGLDisplay.world_visibility=1+4;\nGLDisplay.back_action=\"onBack\";\nShowManager.dispinfo=0;\n\nMath.randomize();\n\nif (ShowManager.prev_show==\"\")\n  addDemoCreatures();\n\nloadCurrent();\nvar g=GenePools[0][0];\naddText3D(g.name,0,0.5,0).position=(10,7.2,6);\nvar pos=(10,7.2,5.2);\nvar txt=\"\";\nif (g.data->imported) txt=\"imported\";\nif (g.data->edited) {if (txt!=\"\") txt+=\", \"; txt+=\"edited\";}\nif (txt!=\"\")\n    {addText3D(txt,0,0.4,0).position=pos; pos.z-=0.6;}\nif (g.data->selections > 0)\n    {addText3D(\"Selective breeding:\\n\"+g.data->selections+\" generations\",0,0.4,0).position=pos; pos.z-=1;}\nif (g.data->evaluations > 0)\n    {addText3D(\"Evolved by evaluating\\n\"+g.data->evaluations+\" genotypes\",0,0.4,0).position=pos; pos.z-=1;}\n\nif (g.velocity!=0) addText3D(\"Velocity: %.6f\" % g.velocity,0,0.4,0).position=(10,7.2,2.5);\nif (g.vertpos!=0) addText3D(\"Height: %.2f\" % g.vertpos,0,0.4,0).position=(10,7.2,2);\n\nvar o=Obj3D.newFromCreature(GenePools[0][0].genotype);\nvar pos=(0,0,0);\nvar center=o.center;\nvar scale=2.5/o.size;\ncenter.scale(scale);\npos.sub(center);\nvar m=Matrix.newTranslation(pos);\nm=m.scale(scale);\no.transform=m;\ng_floating_orient=Matrix.new();\n\nvar anchor=Obj3D.newEmpty();\nanchor.transform=Matrix.newTranslation((10,10,4));\ng_floating=Obj3D.newEmpty();\n\nGLDisplay.world3d.add(anchor);\nanchor.add(g_floating);\ng_floating.add(o);\n\nCreatureSelection.clear();\n\nvar but;\nbut=GUI.newButton(\"AL-play\",\"Playground\");\nbut.setAutolayout(0,0,0,0, 0.01,1.0-0.15-0.01, 0.3,0.15);\n\nvar y=1.0;\nfor(var b in [\n\t[\"AL-edit\",\"Edit genotype\"], //\"Genetic Lab\"\n\t[\"AL-biomorph\",\"Guide evolution\"], //\"Evolutionary steps\"\n\t[\"AL-evol\",\"Evolve\"]]) //\"Evolutionary reactor\" (or \"loop\")\n   {\n   but=GUI.newButton(b[0],b[1]);\n   y-=0.15;\n   but.setAutolayout(0,0,0,0, 1.0-0.3-0.01,y,0.3,0.15);\n   }\ny-=0.15;\nbut=GUI.newLabel(\"\",\"Modify this creature:\");\nbut.setAutolayout(0,0,0,0, 1.0-0.3-0.01,y,0.3,0.15);\nbut.align=0;\nbut.valign=1;\nbut.fgcolor=0xff000000;\n\ng_helptxt=\"\"\"<h1>Welcome to the Artificial Life laboratory!</h1><br>\nUse buttons to visit rooms in the lab. You can guide selection of creatures, see their evolution, play with them, and, if you are really ambitious, you can modify their genes in the Genetic Lab!<br><br>Mutations in the genetic code occur randomly, so your results will be unique.\"\"\";\n\nbut=GUI.newButton(\"share\",\"\");\nbut.image=\"share-icon-shadow\";\nbut.style=1;\nbut.addTo(GUI.top_right);\n\naddHelpButton(GUI.top_right);\n\nGLDisplay.skybox=\"whiteworld_\";\naddBottleObject();\n\nTrackingCam.cam_world=0;\n\nTrackingCam.cam_change=1;\nTrackingCam.setTarget(10,10,3,7);\nTrackingCam.tick(0);\n\nTrackingCam.cam_change=2;\nTrackingCam.setTarget(10,10,3,12);\n\ng_restore_anim=0;\n\nif (Populations[0].size>0)\n   GLDisplay.desiredsimspeed = 50;\n\ng_hide_screenshot=[\"AL-history\",\"AL-play\",\"gen\",\"helpbut\",\"share\"];\n}\n\nfunction onShowStep()\n{\ng_floating_orient=g_floating_orient.mul(Matrix.newRotation((Math.sin(Math.time*0.03)*0.01,Math.sin(Math.time*0.04)*0.01,Math.sin(Math.time*0.05)*0.01)));\n\ng_floating.transform=g_floating_orient.mul(Matrix.newTranslation((Math.sin(Math.time*0.21)*0.2,Math.sin(Math.time*0.23)*0.2,Math.sin(Math.time*0.09)*0.3)));\n\nvar anim=Math.time;\nif ((TrackingCam.interacting==0) && (g_restore_anim==0))\n\t{\n\tTrackingCam.setViewDir(90.0 + 30.0 + 20.0*Math.sin(anim*0.43), 10.0 + 10.0*Math.cos(anim*0.5));\n\t}\nelse\n\t{\n\tif (g_restore_anim==0)\n\t\tg_restore_anim=Math.time+5.0;\n\t}\nif ((g_restore_anim>0) && (Math.time>g_restore_anim))\n\t{\n\tg_restore_anim=0;\n\t}\n\n//printobj3d(GLDisplay.world3d,0);\n}\n\nfunction onGUIEvent(elem,arg)\n{\nif (handleHelp(elem)) return;\nif (handleSharing(elem)) return;\n\nif (String.startsWith(elem.name,\"AL-\"))\n\t{\n\tShowManager.show=elem.name;\n\treturn;\n\t}\n}\n\nfunction onBack()\n{\nif (closePopup()) return;\nGUI.setTimeout(\"back\",1,function goUp);\nTrackingCam.cam_change=2;\nTrackingCam.setTarget(10,10,3,30);\n}\n\nfunction goUp()\n{\nShowManager.show=\"AL-history\";\n}\n\n"
  }
]