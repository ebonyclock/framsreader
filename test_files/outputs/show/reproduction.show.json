[
  {
    "name": "Evolution (endogenous fitness)",
    "_classname": "show",
    "info": "Reproduction",
    "expdef": "reproduction",
    "code": "\nglobal g_step, g_step2;\nglobal g_chart, g_win;\nglobal g_neuro, g_neurowin;\nglobal g_chart2, g_win2;\n\nfunction onLoad()\n{\n  ShowManager.info = Simulator.expdef_info;\n  Math.seed = Math.time;\n  World.wrldtyp = 0;\n  World.wrldsiz = 40;\n  World.wrldwat = -1.0;\n  World.wrldbnd = 0;\n  Simulator.init();\n  ExpProperties.autorestart = 0;\n  TrackingCam.setViewDir(30, 30);\n  TrackingCam.cam_chspeed = 0.1;\n  TrackingCam.cam_trspeed = 1;\n  g_step = 0;\n  g_step2 = 0;\n\n  g_chart = DynaChart.new();\n  g_win = GLDisplay.createWindow(1 + 2 + 4 + 16, \"Population size\", g_chart);\n  g_win.backcolor = 0x80ddddff;\n  g_win.size_x = GLDisplay.size_x / 2;\n  g_win.size_y = GLDisplay.size_y / 3;\n\n  g_chart2 = DynaChart2D.new();\n  g_win2 = GLDisplay.createWindow(1 + 2 + 4 + 16, \"Creatures vs. Food\", g_chart2);\n  g_win2.backcolor = 0x80ffdddd;\n  g_win2.size_x = GLDisplay.size_x / 2;\n  g_win2.size_y = GLDisplay.size_y / 3;\n\n  GLDisplay.desiredsimspeed = 100;\n}\n\nfunction onShowStep()\n{\n  //g_step=g_step+1; Simulator.print(\"step: \"+g_step);\n  TrackingCam.cam_dir += 0.05;\n  g_step++;\n  if (GLDisplay.desiredsimspeed == 0)\n  {\n    GLDisplay.banner = \"Extinction. Experiment restarted.\";\n    ShowProperties_restart_call();\n  }\nif ((g_step&31)==0)\n  g_chart2.add(Populations.get(0).size,Populations.get(1).size);\n\n  if (g_step > 100)\n  {\n//    onSelectionChange();\n\n    g_chart.add(Populations.get(0).size);\n    g_step = 1;\n    g_step2++;\n\n    if (g_step2 > 10)\n    {\n      g_step2 = 1;\n      if (CreatureSelection.count>0)\n        CreatureSelection.clear();\n      else\n      {\n        var g = Populations.get(0);\n        if (g.size > 0)\n        {\n          CreatureSelection.clear();\n          CreatureSelection.add(g.get(0));\n        }\n      }\n    }\n  }\n}\n\nfunction onSelectionChange()\n{\n  var t = \"\";\n  if (CreatureSelection.count > 0)\n  {\n    var c = CreatureSelection.get(0);\n    t += \"\\nCurrent creature: \" + c.name + \"\\n\";\n    t += \"Current genotype: \" + c.genotype + \"\\n\";\n    if (c.numneurons > 0)\n      showNN(c);\n    else\n      hideNN();\n  }\n  else\n    hideNN();\n  GLDisplay.banner = t;\n}\n\nfunction showNN(c)\n{\n  if (g_neurowin == null)\n  {\n    g_neuro = NeuroDiagram.new();\n    g_neurowin = GLDisplay.createWindow(1 + 2 + 4 + 16, \"Neurons\", g_neuro);\n    g_neurowin.backcolor = 0x80ffdddd;\n    g_neurowin.size_x = GLDisplay.size_x / 3;\n    g_neurowin.size_y = GLDisplay.size_y / 3;\n    g_neurowin.pos_x = 0;\n    g_neurowin.pos_y = GLDisplay.size_y - g_win.size_y - 18;\n  }\n  g_neuro.showCreature(c);\n}\n\nfunction hideNN()\n{\n  if (g_neurowin)\n    GLDisplay.deleteWindow(g_neurowin);\n  g_neurowin = null;\n  g_neuro = null;\n}\n\nfunction onResize()\n{\n  g_win.size_x = GLDisplay.size_x / 3;\n  g_win.size_y = GLDisplay.size_y / 3;\n  g_win.pos_x = GLDisplay.size_x - g_win.size_x;\n  g_win.pos_y = GLDisplay.size_y - g_win.size_y - 18;\n\n  g_win2.size_x = g_win.size_x;\n  g_win2.size_y = g_win.size_y;\n  g_win2.pos_x = g_win.pos_x-g_win2.size_x;\n  g_win2.pos_y = g_win.pos_y;\n\n  if (!g_neurowin)\n    return ;\n  g_neurowin.size_x = GLDisplay.size_x / 3;\n  g_neurowin.size_y = GLDisplay.size_y / 3;\n  g_neurowin.pos_x = 0;\n  g_neurowin.pos_y = GLDisplay.size_y - g_win.size_y - 18;\n}\n\nfunction ShowProperties_restart_call()\n{\n  Simulator.init();\n  GLDisplay.desiredsimspeed = 100;\n  Simulator.print(\"Restarting experiment...\");\n  g_chart.clear();\n  g_chart2.clear();\n  g_step = 0;\n}\n\n"
  },
  {
    "id": "restart",
    "_classname": "property",
    "type": "p",
    "name": "Restart"
  }
]