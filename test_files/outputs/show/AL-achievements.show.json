[
  {
    "name": "Achievements",
    "_classname": "show",
    "expdef": "standard",
    "code": "\n@include \"AL-shared.inc\"\n@include \"AL-achievements.inc\"\n\nfunction onBack()\n{\nif (closePopup()) return;\nShowManager.show=\"AL-top\";\n}\n\nfunction onLoad()\n{\n\tGLDisplay.simsteps = 0;\n\tGLDisplay.user_interaction=0;\n\tGLDisplay.world_visibility=1;\n\tGLDisplay.back_action=\"onBack\";\n\tShowManager.dispinfo=0;\n\t\n\tloadHistory();\n\t\n\tvar but; //TODO describe in help that \"design a creature\" means \"engineer a genome\" using genetic editor. \n\n\tinitAchievementDefinitions();\n\tvar done=calcCompletedAchievements();\n\tvar progress=GUI.newGroup(\"\");\n\tprogress.bgcolor=0x88000000;\n\tprogress.setAutolayout(0,0,0,0, 0.15,0.01,0.7,0.15);\n\tvar progress_fill=GUI.newGroup(\"\");\n\tprogress_fill.setAutolayout(0,0,0,0, 0.01,0.05,float(done)/g_achievements.size*0.98,0.9);\n\tprogress_fill.bgcolor=0x6600ff00;\n        progress_fill.addTo(progress);\n\tvar lab=GUI.newLabel(\"\",\"Completed \"+done+\" of \"+g_achievements.size+\" achievements\");\n        lab.addTo(progress);\n\tlab.setAutolayout(0,0,0,0, 0,0,1,1);\n\tlab.align=0;\n\n\tvar li=GUI.newList(\"list\");\n\tli.font=2;\n\tli.setAutolayout(0,0,0,0, 0.05,0.17,0.9,0.82); //the list takes 82% vertically\n\tli.align=1;// list scrolls vertically\n\tli.valign=0;// center list labels vertically\n\n\tfor(var achievement in g_achievements)\n\t{\n\t\tvar s=describeAchievement(achievement);\n\t\tvar goodgenos=[];\n\t\tfor(var g in GenePools[0])\n\t\t{\n\t\t\tif (checkAchievement(achievement,g)==1)\n\t\t\t\tgoodgenos.add(g);\n\t\t}\n\t\tif (goodgenos.size>0)\n\t\t{\n\t\t\ts+=\"\\nThis is fulfilled by \"+goodgenos.size;\n\t\t\tif (goodgenos.size==1) \n\t\t\t\ts+=\" creature: \"+goodgenos[0].name+\".\";\n\t\t\telse\n\t\t\t\ts+=\" creatures, for example \"+goodgenos[0].name+\".\";\n\t\t\tli.addItem(s,\"creature:\"+goodgenos[0].genotype);\n\t\t}\n\t\telse\n\t\t{\n\t\t\ts+=\"\\nGO FOR IT!\";\n\t\t\tli.addItem(s,\"redclosex\");\n\t\t}\n\t}\n}\n\nfunction layoutList()\n{\n\tvar li=GUI->list.rowheight=GUI.fontHeight(2)*5; //list items size depends on the default font height\n}\n\nfunction onResize()\n{\n\tlayoutList();\n}\n\nfunction unicodeRelationSymbol(rel)\n{\n\tvar SYMBOLS={\"<\":\"<\", \">\":\">\", \"=\":\"=\", \"<=\":\"\u2264\", \">=\":\"\u2265\"};\n\treturn SYMBOLS[rel];\n}\n\nfunction describeCriterion(crit,achievementvalue)\n{\n\tvar CRITERIA={\n\t\t\"format\":\"the genetic encoding\",\n\t\t\"numparts\":\"the number of parts\",\n\t\t\"numjoints\":\"the number of sticks\",\n\t\t\"velocity\":\"the speed\",\n\t\t\"water_velocity\":\"the speed in water\",\n\t\t\"vertpos\":\"the height of the center\"};\n\tif (crit[0]==\"format\")\n\t\treturn CRITERIA[crit[0]]+\" f\"+achievementvalue;\n\telse\n\t\treturn CRITERIA[crit[0]]+\" \"+unicodeRelationSymbol(crit[1])+\" \"+achievementvalue;\n}\n\nfunction describeOrigin(origin)\n{\n\tvar o=\"Design or evolve\"; //default: origin not specified\n\tif (origin==\"D\")\n\t\to=\"Design\"; else\n\tif (origin==\"E\")\n\t\to=\"Evolve\";\n\treturn o+\" a creature with \";\n}\n\nfunction describeAchievement(achievement)\n{\n\tvar s=\"\";\n\tvar achievementcopy=achievement.clone(); //we need a copy because we have to put \" and \" only between the last pair of conditions, but we don't know how many conditions there are because...\n\tachievementcopy.remove(\"origin=\"); //...\"origin\" influences the beginning of the sentence (not displayed as a condition) and it is optional in the achievement dictionary\n\tfor(var i=0;i<achievementcopy.size;i++)\n\t{\n\t\tvar crit=getCriterionAndRelation(achievementcopy.getKey(i));\n\t\tif (i>0)\n\t\t\tif (i==achievementcopy.size-1) //last pair of conditions?\n\t\t\t\ts+=\" and \";\n\t\t\telse\n\t\t\t\ts+=\", \";\n\t\ts+=describeCriterion(crit,achievementcopy.get(i));\n\t}\n\treturn describeOrigin(achievement[\"origin=\"])+s+\".\";\n}\n\nfunction onGUIEvent(elem,arg)\n{\n\tif (handleHelp(elem)) return;\n}\n\n"
  }
]