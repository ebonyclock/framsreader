[
  {
    "name": "Your creatures",
    "_classname": "show",
    "expdef": "standard",
    "code": "@include \"AL-shared.inc\"\n\nglobal g_trash_submenu;\n\nfunction onLoad()\n{\nGLDisplay.simsteps = 0;\nGLDisplay.user_interaction=0;\nGLDisplay.world_visibility=1;\nGLDisplay.back_action=\"\";\nShowManager.dispinfo=0;\n\nloadCurrent();\nvar cur=GenePools[0][0];\n\nloadHistory();\n\nvar but;\n\nbut=GUI.newButton(\"use\",\"Use selected\");\nbut.bgcolor=0xff66cc66; but.fgcolor=0xffffffff;\nbut.setAutolayout(0,0,0,0, 0.31,0.01, 0.3,0.15);\nbut=GUI.newButton(\"cancel\",\"Back\");\nbut.setAutolayout(0,0,0,0, 0.01,0.01, 0.3,0.15);\n\nvar gr=GUI.newGroup(\"namegroup\");\nvar lab=GUI.newLabel(\"namelabel\",\"Name:\");\nlab.addTo(gr);\nlab.setAutolayout(0,0,0,0, 0,0,0.7,0.5);\nvar ed=GUI.newTextField(\"name\",\"?\");\ned.font=3;\ned.addTo(gr);\ned.setAutolayout(0,0,0,0, 0,0.5,0.7,0.5);\nvar save=GUI.newButton(\"save\",\"Save\");\nsave.visible=0;\nsave.setAutolayout(0,0,0,0, 0.71,0,0.29,1);\nsave.addTo(gr);\n\nvar li=GUI.newList(\"hist\");\nlayoutHistory();\nfor(var g in GenePools[0])\n   li.addItem(labelForGenotype(g),\"creature:\"+g.genotype);\nli.selected=findGenotypeAndName(cur.name,cur.genotype,GenePools[0]);\nif (li.selected<0)\n   li.selected=li.itemcount-1;\nli.scrollIntoView(li.selected);\n\ng_trash_submenu=[];\nbut=GUI.newButton(\"del\",\"Delete selected\");\n//but.setAutolayout(0,0,0,0, 0.01,1.0-0.15-0.01, 0.3,0.15);\nbut.bgcolor=0xffff0000; but.fgcolor=0xffffffff;\nbut.visible=0;\ng_trash_submenu.add(but);\nbut=GUI.newButton(\"del_all\",\"Delete all\");\n//but.setAutolayout(0,0,0,0, 1.0-0.3-0.01,1.0-0.15-0.01, 0.3,0.15);\nbut.bgcolor=0xffff0000; but.fgcolor=0xffffffff;\nbut.visible=0;\ng_trash_submenu.add(but);\n\nbut=GUI.newButton(\"trash\",\"\");\nbut.image=\"trash-icon-shadow\";\nbut.style=1;\nbut.addTo(GUI.top_right);\n\ng_helptxt=\"This is a scrollable list of all the creatures you saved previously. You can select any of them and improve it further.\";\naddHelpButton(GUI.top_right);\n}\n\nfunction genotypeHistoryLabel(vars)\n{\nvar ret=\"\";\nif (vars->selections) ret+=\"sel:\"+vars->selections+\" \";\nif (vars->evaluations) ret+=\"evol:\"+vars->evaluations+\" \";\nif (vars->imported) ret+=\"imported \";\nif (vars->edited) ret+=\"edited \";\nreturn ret;\n}\n\nfunction labelForGenotype(g)\n{\nvar label=g.name;\nvar history=genotypeHistoryLabel(g.data);\nif (history!=\"\") label+=\"\\n\"+history;\nlabel+=\"\\t\";\nif (g.velocity>0)\n    label+=\"Velocity: %.6f\\n\" % g.velocity;\nif (g.vertpos>0)\n    label+=\"Height: %.2f\\n\" % g.vertpos;\nlabel+=formatTime(g.data->time);\nreturn label; \n}\n\nfunction formatTime(t)\n{\nif (t==0) return \"\";\nvar txt=\"%t\" % t;\ntxt=String.substr(txt,8,3)+String.substr(txt,4,4)+String.substr(txt,11,5);\nif (String.left(txt,1)==\" \") txt=String.substr(txt,1,999);\nreturn txt;\n}\n\nfunction deleteSelected()\n{\nvar li=GUI[\"hist\"];\nvar sel=li.selected;\nif (sel<0) return; //no selection\nif (sel==0) return; //initial genotype\nli.removeItem(sel);\nGenePools[0][sel].delete();\nsaveHistory();\nonGUIEvent(GUI[\"trash\"],null);\n}\n\nfunction deleteAll()\n{\nvar li=GUI[\"hist\"];\nli.selected=0;\nfor(var i=li.itemcount-1;i>0;i--)\n  {\n  li.removeItem(i);\n  GenePools[0][i].delete();\n  }\nsaveHistory();\nonGUIEvent(GUI[\"trash\"],null);\n}\n\nfunction useSelected()\n{\nvar li=GUI[\"hist\"];\nvar sel=li.selected;\nif (sel<0) return;\n\nvar r=li.getItemRect(sel);\nif (r)\n   {\n   var m=GUI.newModel(\"\",GenePools[0][sel].genotype);\n   m.rect=r;\n   li.setItemImage(sel,\"\");\n   m.animSetBegin();\n   m.setRect(-GLDisplay.size_x/2,-GLDisplay.size_y/2,2*GLDisplay.size_x,2*GLDisplay.size_y);\n   m.animSetEnd();\n   m.startAnimation(0.5);\n   GUI.setTimeout(\"\",0.5,function useSelectedLater);\n   }\n\nif (sel==0) //initial genotype\n   {\n   GenePools[0].clear();\n   saveCurrent();\n   }\nelse\n   {\n   var g=GenePools[0][sel];\n   GenePools[0].clear();\n   g.moveTo(GenePools[0]);\n   saveCurrent();\n   }\n\nif (!r)\n   ShowManager.show=\"AL-main\";\n}\n\nfunction useSelectedLater()\n{\nShowManager.show=\"AL-main\";\n}\n\nfunction onShowStep()\n{\nvar h=GUI[\"hist\"];\nif (h.align==0)\n   TrackingCam.setViewDir(10.0*(h.scroll_x/GLDisplay.size_x),0);\nelse\n   TrackingCam.setViewDir(0,10.0*(h.scroll_y/GLDisplay.size_y));\n}\n\nfunction nameClicked(arg)\n{\nif (arg==1)\n    GUI[\"save\"].visible=1;\nelse if (arg==0)\n    GUI[\"save\"].visible=0;\n}\n\nfunction histClicked()\n{\nvar i=GUI[\"hist\"].selected;\nGUI[\"name\"].text=GenePools[0][i].name;\nGUI[\"namegroup\"].visible=(i>0);\n}\n\nfunction saveClicked()\n{\nvar i=GUI[\"hist\"].selected;\nif (i<=0) return;\nvar g=GenePools[0][i];\nvar n=GUI[\"name\"].text;\nif (g.name==n) return;\ng.name=n;\nsaveHistory();\nGUI[\"hist\"].setItemLabel(i,labelForGenotype(g));\n}\n\nfunction onGUIEvent(elem,arg)\n{\nif (elem.name!=\"name\")\n    GUI[\"name\"].focus=0;\nif (handleHelp(elem)) return;\nswitch(elem.name)\n\t{\n\tcase \"trash\":\n\t     handleSubMenu(elem,g_trash_submenu,1,0.25,0.14);\n\t     return;\n\tcase \"del\": deleteSelected(); break;\n\tcase \"del_all\": deleteAll(); break;\n\tcase \"use\": useSelected(); break;\n\tcase \"cancel\": ShowManager.show=\"AL-top\"; break;\n\tcase \"hist\": histClicked(); break;\n        case \"name\": nameClicked(arg); break;\n        case \"save\": saveClicked(); break;\n\t}\n}\n\nfunction onResize()\n{\nlayoutHistory();\n}\n\nfunction layoutHistory()\n{\nvar li=GUI[\"hist\"];\nvar h=GUI.fontHeight(GUI[\"name\"].font);\nGUI[\"namegroup\"].setAutolayout(0,0,0,4*h, 0.01,0.175,0.98,0);\nif (GLDisplay.size_x>GLDisplay.size_y)\n   {\n   li.align=0; li.valign=2;\n   li.setAutolayout(0,4*h,0,-4*h, 0.01,0.2,0.98,0.8);\n   li.rowheight=GLDisplay.size_x/4;\n   }\nelse\n   {\n   li.align=1; li.valign=0;\n   li.setAutolayout(0,4*h,0,-4*h, 0.01,0.2,0.98,0.8);\n   li.rowheight=GLDisplay.size_y/5;\n   }\n}\n\nfunction onKey(code)\n{\nif (code==GUI.KEY_BACK)\n   {\n   if (closePopup()) return 1;\n   onGUIEvent(GUI[\"cancel\"],null);\n   return 1;\n   }\nreturn 0;\n}\n\n"
  }
]